I"Ó"<h1 id="kind-ë¥¼-ì´ìš©í•œ-ì¿ ë²„ë„¤í‹°ìŠ¤-ë¡œì»¬-ì„¤ì¹˜-ê°€ì´ë“œ">Kind ë¥¼ ì´ìš©í•œ ì¿ ë²„ë„¤í‹°ìŠ¤ ë¡œì»¬ ì„¤ì¹˜ ê°€ì´ë“œ</h1>

<h2 id="1-what-is-kind">1. What is Kind?</h2>

<h2 id="2-install-kind">2. Install Kind</h2>

<p>ì„¤ì¹˜ ê°€ì´ë“œ URL : https://kind.sigs.k8s.io/docs/user/quick-start/#installation</p>

<h3 id="macos">MacOS</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>brew install kind
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="windows">Windows</h3>

<pre><code class="language-{bash}">choco install kind
</code></pre>

<h3 id="linux">Linux</h3>

<pre><code class="language-{bash}">curl.exe -Lo kind-windows-amd64.exe https://kind.sigs.k8s.io/dl/v0.15.0/kind-windows-amd64
Move-Item .\kind-windows-amd64.exe c:\some-dir-in-your-PATH\kind.exe
</code></pre>

<h2 id="3-kind-ë¡œ-í´ëŸ¬ìŠ¤í„°-ìƒì„±ì´ˆê°„ë‹¨">3. Kind ë¡œ í´ëŸ¬ìŠ¤í„° ìƒì„±(ì´ˆê°„ë‹¨)</h2>

<h3 id="í´ëŸ¬ìŠ¤í„°-ìƒì„±">í´ëŸ¬ìŠ¤í„° ìƒì„±</h3>

<pre><code class="language-{bash}">kind create cluster # Default cluster context ì´ë¦„ì€ 'kind' ë¡œ ìƒì„±
kind create cluster --name dangtong # cluster context ì´ë¦„ì„ 'dangtong' ìœ¼ë¡œ ì§€ì •
</code></pre>

<h3 id="í´ëŸ¬ìŠ¤í„°-ìƒì„±-í™•ì¸">í´ëŸ¬ìŠ¤í„° ìƒì„± í™•ì¸</h3>

<pre><code class="language-{bash}">kind get clusters
kubectl cluster-info --context dangtong
</code></pre>

<h3 id="í´ëŸ¬ìŠ¤í„°-ì‚­ì œ">í´ëŸ¬ìŠ¤í„° ì‚­ì œ</h3>

<pre><code class="language-{bash}">kind delete cluster
</code></pre>

<h2 id="4-ì„¤ì •-íŒŒì¼ì„-ì´ìš©í•œ-kind-í´ëŸ¬ìŠ¤í„°-ìƒì„±">4. ì„¤ì • íŒŒì¼ì„ ì´ìš©í•œ Kind í´ëŸ¬ìŠ¤í„° ìƒì„±</h2>

<h3 id="41-í´ëŸ¬ìŠ¤í„°-ìƒì„±">4.1 í´ëŸ¬ìŠ¤í„° ìƒì„±</h3>

<h4 id="ì„¤ì •-íŒŒì¼ì„-ì´ìš©í•œ-í´ëŸ¬ìŠ¤í„°-ìƒì„±">ì„¤ì • íŒŒì¼ì„ ì´ìš©í•œ í´ëŸ¬ìŠ¤í„° ìƒì„±</h4>

<p>ì„¤ì •íŒŒì¼ì„ ì´ìš©í•´ì„œ kind í´ëŸ¬ìŠ¤í„°ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<pre><code class="language-{bash}">kind create cluster --config kind-example-config.yaml
</code></pre>

<h4 id="3ê°œ-ë…¸ë“œ-í´ëŸ¬ìŠ¤í„°-ìƒì„±">3ê°œ ë…¸ë“œ í´ëŸ¬ìŠ¤í„° ìƒì„±</h4>

<p>3ê°œ ë…¸ë“œ(1 controller, 2worker) í´ëŸ¬ìŠ¤í„° ì„¤ì •</p>

<p>```{ bash}</p>
<h1 id="three-node-two-workers-cluster-config">three node (two workers) cluster config</h1>
<p>kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:</p>
<ul>
  <li>role: control-plane</li>
  <li>role: worker</li>
  <li>role: worker
```</li>
</ul>

<h4 id="6ê°œ-ë…¸ë“œ-í´ëŸ¬ìŠ¤í„°-ìƒì„±">6ê°œ ë…¸ë“œ í´ëŸ¬ìŠ¤í„° ìƒì„±</h4>

<pre><code class="language-{bash}">kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
- role: control-plane
- role: control-plane
- role: worker
- role: worker
- role: worker
</code></pre>

<h3 id="42-ì¿ ë²„ë„¤í‹°ìŠ¤-ë²„ì „-ì„¤ì •">4.2 ì¿ ë²„ë„¤í‹°ìŠ¤ ë²„ì „ ì„¤ì •</h3>

<p>ì¿ ë²„ë„¤í‹°ìŠ¤ ë²„ì „ì— ë”°ë¥¸ ì´ë¯¸ì§€ëŠ” ë§í¬ì—ì„œ í™•ì¸ ê°€ëŠ¥ : https://github.com/kubernetes-sigs/kind/releases</p>

<pre><code class="language-{bash}">kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  image: kindest/node:v1.16.4@sha256:b91a2c2317a000f3a783489dfb755064177dbc3a0b2f4147d50f04825d016f55
- role: worker
  image: kindest/node:v1.16.4@sha256:b91a2c2317a000f3a783489dfb755064177dbc3a0b2f4147d50f04825d016f55
</code></pre>

<h3 id="43-ë„¤íŠ¸ì›Œí¬-ì„¤ì •">4.3 ë„¤íŠ¸ì›Œí¬ ì„¤ì •</h3>

<h4 id="pod-subnet-ì„¤ì •">Pod Subnet ì„¤ì •</h4>

<pre><code class="language-{bash}">kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
networking:
  podSubnet: "10.244.0.0/16"
</code></pre>

<h4 id="service-subnet-ì„¤ì •">Service Subnet ì„¤ì •</h4>

<pre><code class="language-{bash}">kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
networking:
  serviceSubnet: "10.96.0.0/12"
</code></pre>

<h4 id="default-cni-ì„¤ì •">Default CNI ì„¤ì •</h4>

<p>Caliaco ì™„ ê°™ì€ 3rd party CNI ì‚¬ìš©ì„ ìœ„í•´ì„œëŠ” default CNI ì„¤ì¹˜ë¥¼ í•˜ì§€ ë§ì•„ì•¼ í•©ë‹ˆë‹¤.</p>

<pre><code class="language-{bash}">kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
networking:
  # default CNIê°€ ì„¤ì¹˜ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
  disableDefaultCNI: true
</code></pre>

<h4 id="kube-proxy-ëª¨ë“œ-ì„¤ì •">kube-proxy ëª¨ë“œ ì„¤ì •</h4>

<p>iptables ë˜ëŠ” IPVS ì¤‘ì— ì„ íƒí•´ì„œ ì‚¬ìš© ê°€ëŠ¥. default ëŠ” iptables</p>

<pre><code class="language-{bash}">kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
networking:
  kubeProxyMode: "ipvs"
</code></pre>

<h3 id="45-ingress-ë°-loadbalancer-ì„¤ì •">4.5 Ingress ë° LoadBalancer ì„¤ì •</h3>

<p>Ingress ë° Loadbalancer ë¥¼ ì„¤ì •í•˜ê¸° ìœ„í•´ì„œëŠ” KIND ë¥¼ ì´ìš©í•œ í´ëŸ¬ìŠ¤í„° ìƒì„±ì‹œ  extraPortMapping ì„¤ì •ì„ í•˜ê³ , kubeadmíˆ´ì„ í†µí•´ custom node label ì„ ë…¸ë“œì— ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.</p>

<h4 id="ingress-ê°€ëŠ¥í•œ-í´ëŸ¬ìŠ¤í„°-ìƒì„±">Ingress ê°€ëŠ¥í•œ í´ëŸ¬ìŠ¤í„° ìƒì„±</h4>

<p>kind í´ëŸ¬ìŠ¤í„°ë¥¼ extraPortMappings ë° node-lables ì„¤ì •ê³¼ í•¨ê»˜ ìƒì„± í•©ë‹ˆë‹¤.</p>

<ul>
  <li>ExtreaPortMappings : ë¡œì»¬ í˜¸ìŠ¤íŠ¸ê°€ 80 ë° 443 í¬íŠ¸ë¥¼ í†µí•´ Ingress Controllerë¡œ ìš”ì²­ì´ ê°€ëŠ¥í•˜ê²Œ ì„¤ì •í•©ë‹ˆë‹¤.</li>
  <li>nodeâ€“labels : Ingress Controller ê°€ íŠ¹ì • ë¼ë²¨ì„ ê°€ì§„ ë…¸ë“œì—ì„œë§Œ ìˆ˜í–‰ ë˜ë„ë¡ í•©ë‹ˆë‹¤.</li>
</ul>

<pre><code class="language-{bash}">cat &lt;&lt;EOF | kind create cluster --config=-
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  kubeadmConfigPatches:
  - |
    kind: InitConfiguration
    nodeRegistration:
      kubeletExtraArgs:
        node-labels: "ingress-ready=true"
  extraPortMappings:
  - containerPort: 80
    hostPort: 80
    protocol: TCP
  - containerPort: 443
    hostPort: 443
    protocol: TCP
EOF
</code></pre>

<p>#### Countour Ingress ìƒì„±</p>

<ul>
  <li>Contour ì„¤ì¹˜</li>
</ul>

<pre><code class="language-{bash}">kubectl apply -f https://projectcontour.io/quickstart/contour.yaml
</code></pre>

<ul>
  <li>Contour ì„¤ì • ì—…ë°ì´íŠ¸</li>
</ul>

<pre><code class="language-{bash}">kubectl patch daemonsets -n projectcontour envoy -p '{"spec":{"template":{"spec":{"nodeSelector":{"ingress-ready":"true"},"tolerations":[{"key":"node-role.kubernetes.io/control-plane","operator":"Equal","effect":"NoSchedule"},{"key":"node-role.kubernetes.io/master","operator":"Equal","effect":"NoSchedule"}]}}}}'
</code></pre>

<h4 id="kong-ingress-ìƒì„±">Kong Ingress ìƒì„±</h4>

<ul>
  <li>Kong ì„¤ì¹˜</li>
</ul>

<pre><code class="language-{bash}">kubectl apply -f https://raw.githubusercontent.com/Kong/kubernetes-ingress-controller/master/deploy/single/all-in-one-dbless.yaml
</code></pre>

<ul>
  <li>Kong ì„¤ì • ì—…ë°ì´íŠ¸</li>
</ul>

<pre><code class="language-{bash}">kubectl patch deployment -n kong ingress-kong -p '{"spec":{"template":{"spec":{"containers":[{"name":"proxy","ports":[{"containerPort":8000,"hostPort":80,"name":"proxy","protocol":"TCP"},{"containerPort":8443,"hostPort":443,"name":"proxy-ssl","protocol":"TCP"}]}],"nodeSelector":{"ingress-ready":"true"},"tolerations":[{"key":"node-role.kubernetes.io/control-plane","operator":"Equal","effect":"NoSchedule"},{"key":"node-role.kubernetes.io/master","operator":"Equal","effect":"NoSchedule"}]}}}}'
</code></pre>

<h4 id="nginx-ingress-ìƒì„±">Nginx Ingress ìƒì„±</h4>

<ul>
  <li>Nginx ì„¤ì¹˜</li>
</ul>

<pre><code class="language-{bash}">kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/kind/deploy.yaml
</code></pre>

<ul>
  <li>Nginx ì„¤ì • ì—…ë°ì´íŠ¸</li>
</ul>

<pre><code class="language-{bash}">kubectl wait --namespace ingress-nginx \
  --for=condition=ready pod \
  --selector=app.kubernetes.io/component=controller \
  --timeout=90s
</code></pre>

<h4 id="ingress-ì‚¬ìš©í•˜ê¸°">Ingress ì‚¬ìš©í•˜ê¸°</h4>

<pre><code class="language-{bash}">kind: Pod
apiVersion: v1
metadata:
  name: foo-app
  labels:
    app: foo
spec:
  containers:
  - name: foo-app
    image: hashicorp/http-echo:0.2.3
    args:
    - "-text=foo"
---
kind: Service
apiVersion: v1
metadata:
  name: foo-service
spec:
  selector:
    app: foo
  ports:
  # Default port used by the image
  - port: 5678
---
kind: Pod
apiVersion: v1
metadata:
  name: bar-app
  labels:
    app: bar
spec:
  containers:
  - name: bar-app
    image: hashicorp/http-echo:0.2.3
    args:
    - "-text=bar"
---
kind: Service
apiVersion: v1
metadata:
  name: bar-service
spec:
  selector:
    app: bar
  ports:
  # Default port used by the image
  - port: 5678
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: example-ingress
spec:
  rules:
  - http:
      paths:
      - pathType: Prefix
        path: "/foo"
        backend:
          service:
            name: foo-service
            port:
              number: 5678
      - pathType: Prefix
        path: "/bar"
        backend:
          service:
            name: bar-service
            port:
              number: 5678
---
</code></pre>

:ET